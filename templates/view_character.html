<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Character</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bona+Nova:wght@400;700&display=swap">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>

        body {
            font-family: 'Bona Nova', serif;
            margin: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .stats-row {
            display: flex;
            justify-content: space-between;
        }
        .stat-box {
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            flex: 1;
            margin: 0 5px;
        }
        .stat-box p {
            margin: 5px 0;
        }
        .stat-box .modifier {
            font-size: 1.5em;
            font-weight: bold;
        }
        .stat-box .value {
            font-size: 0.9em;
        }
        .stats-section {
            margin-bottom: 20px;
        }
        .stats-section .item {
            margin-bottom: 10px;
        }
        .stats-section .item p {
            margin: 0;
        }
        .stats-section .item .label {
            font-size: 0.9em;
            color: #666;
        }
        .stats-section .item .value {
            font-size: 1.2em;
            font-weight: bold;
        }
        .additional-stats {
            margin-bottom: 40px;
        }
        .additional-stats .item {
            margin-bottom: 10px;
        }
        .additional-stats .item .label {
            font-size: 0.9em;
            color: #666;
        }
        .additional-stats .item .value {
            font-size: 1.2em;
            font-weight: bold;
        }
        .stat-box .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .button {
            display: inline-block;
            padding: 10px;
            margin: 5px;
            background-color: #007bff;
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .white-box {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .additional-row {
            margin-top: 40px;
        }
        .additional-row .stat-box {
            background-color: #e0e0e0;
        }
        .value-0 { background-color: #fff; color: #000; }
        .value-1 { background-color: #f9f9f9; color: #333; }
        .value-2 { background-color: #f0f0f0; color: #666; }
        .value-3 { background-color: #dcdcdc; color: #999; }
        .value-4 { background-color: #bfbfbf; color: #ccc; }
        .value-5 { background-color: #a0a0a0; color: #fff; }
        .grey-box {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }
        .grey-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .grey-box ul li {
            margin-bottom: 10px;
        }
        .grey-box .buttons {
            margin-top: 10px;
            display: flex;
            justify-content: flex-start;
        }
        .grey-box .buttons .button {
            margin-right: 10px;
        }
            /* Tooltip styling */
        .proficiency-item {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .proficiency-item .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the text */
            left: 50%;
            margin-left: -100px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }

        .proficiency-item:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>

        <h1>{{ character.name }}</h1>
         <div class="buttons">
        <form action="{{ url_for('short_rest', name=character.name) }}" method="post">
                            <button type="submit" class="button">Short Rest</button>
                        </form>
        <form action="{{ url_for('long_rest', name=character.name) }}" method="post">
                            <button type="submit" class="button">Long Rest</button>
                        </form>
             </div>


    <br>
 <div class="stats-row">
     <div class="stat-box">
        <p class="label">Race: </p>
        <p class="modifier">{{ character.race }}</p>
        <p class="label">Height & Weight</p>
        <p class="modifier">{{ character.height }} ft / {{ character.weight }} lb</p>
        <p class="label">Passive Perception</p>
        <p class="modifier">{{ character.passive_perception }}</p>

</div>
     <div class="stat-box">
         {% set encumbrance_levels = {
    0: "Unencumbered",
    1: "Lightly Encumbered",
    2: "Moderately Encumbered",
    3: "Heavily Encumbered",
    4: "Extremely Encumbered",
    5: "Can't move"
} %}

                    <p class="label">Movement Speed</p>
                    <p class="modifier">{{ character.active_movement_speed }}</p>
                    <p class="label">Total AC:</p>
                    <p class="modifier">{{ character.total_ac }}</p>
                    <p class="label">Encumbrance Level</p>
                    <p class="modifier">{{ encumbrance_levels.get(character.encumbrance, "Unknown") }}</p>
        </div>

      <div class="stat-box">
            <p>Active Buffs and Debuffs</p>
                        <p>{{ character.encumbrance_penalty_explained }}</p>
                        <p> {{character.injury_fatigue_debuffs | safe  }}</p>

{% set debuff_labels = {
    "debuff_st": "Strength",
    "debuff_dx": "Dexterity",
    "debuff_in": "Intelligence",
    "debuff_ch": "Charisma",
    "debuff_cn": "Constitution",
    "debuff_wp": "Wisdom",
    "debuff_movement": "Movement Speed",
    "debuff_height": "Height",
    "debuff_max_vp": "Max Vitality Points",
    "debuff_max_wp": "Max Wound Points",


} %}



  {% for debuff in character.debuffs %}
                  {% if debuff.value != 0 %} <span>{{ debuff.value }} {{ debuff_labels[debuff.name] }} by {{ debuff.reason }}</span>

    <form action="{{ url_for('remove_debuff', name=character.name, debuff_id=debuff.id) }}" method="post" style="display: inline;">
        {% if debuff.removable %}<button type="submit" style="display: inline-block;">Remove</button> <br>{% endif %}
        {% if not debuff.removable %}<br> {% endif %}
    </form>{% endif %}

{% endfor %}



          </div>

     <div class="stat-box">
        <p class="label">Purse</p>
        <p class="modifier">Gold: {{ character.gold }}</p>
        <p class="modifier">Silver: {{ character.silver }}</p>
        <p class="modifier">Copper: {{ character.copper }}</p>

        <form action="{{ url_for('update_purse', name=character.name) }}" method="post">
            <label for="amount">Amount:</label>
            <input type="number" id="amount" name="amount" placeholder="Enter amount" required>

            <select id="currency" name="currency">
                <option value="gold">Gold</option>
                <option value="silver">Silver</option>
                <option value="copper">Copper</option>
            </select>

             <button type="submit" class="button">Update Purse</button>
        </form>
    </div>
 </div>
        <br>
    <!-- Debuffs and Buffs      -->
          <div class="stats-row">

        </div>
        <br>
<!-- Character Stats -->
        <div class="stats-row">
            <div class="stat-box">
                <p>ST</p>
                <p class="modifier">{{ character.ST_modifier }}</p>
                <p class="value">{{ character.active_ST }}</p>
            </div>
            <div class="stat-box">
                <p>DX</p>
                <p class="modifier">{{ character.DX_modifier }}</p>
                <p class="value">{{ character.active_DX }}</p>
            </div>
            <div class="stat-box">
                <p>CN</p>
                <p class="modifier">{{ character.CN_modifier }}</p>
                <p class="value">{{ character.active_CN }}</p>
            </div>
            <div class="stat-box">
                <p>CH</p>
                <p class="modifier">{{ character.CH_modifier }}</p>
                <p class="value">{{ character.active_CH }}</p>
            </div>
            <div class="stat-box">
                <p>IN</p>
                <p class="modifier">{{ character.IN_modifier }}</p>
                <p class="value">{{ character.active_IN }}</p>
            </div>
            <div class="stat-box">
                <p>WP</p>
                <p class="modifier">{{ character.WP_modifier }}</p>
                <p class="value">{{ character.active_WP }}</p>
            </div>
        </div>
<br>


<!-- Character Armor Section -->
        <div class="stats-row">


            </div>

        <br>


        <br>
        <div class="additional-stats">
            <div class="stats-row">
                <div class="stat-box">
         <div class="form-container">
                <form action="/character/{{ character.name }}/equip_armor" method="POST">
    <label for="armor">Select Armor:</label>
    <select id="armor" name="selected_armor" onchange="this.form.submit()">
        <option value="No Armor" {% if not character.armor.name %}selected{% endif %}>No Armor</option>
        {% for item in armor_items %}
            <option value="{{ item['item_name'] }}" {% if item['item_name'] == character.armor.name %}selected{% endif %}>
                {{ item['item_name'] }}
            </option>
        {% endfor %}
    </select>
</form>

<form action="/character/{{ character.name }}/toggle_shield" method="POST">
    <div class="form-group">
        <label for="shield_equipped">Shield Equipped:</label>
        <input type="checkbox" id="shield_equipped" name="shield_equipped" {% if character.shield_equipped %}checked{% endif %} onclick="this.form.submit()">
    </div>
</form>
             <form action="/character/{{ character.name }}/update_temporary_armor_modifier" method="POST">

        <label for="temporary_armor_modifier" class="label">Any Temporary Armor Effect?:</label>
        <input type="number" id="temporary_armor_modifier" name="temporary_armor_modifier" value="{{ character.temp_armor_modifier }}" step="1" onchange="this.form.submit()">


</form>

     </div>
 </div>
                <div class="stat-box">
                    <p class="label">Vitality Points</p>
                    <p class="modifier">{{ character.active_vitality_points }} // {{ character.max_vitality_points }}</p>
                    <div class="buttons">
                        <form action="{{ url_for('update_character', name=character.name) }}" method="post">
                            <button type="submit" name="increase_vitality" class="button"
                {% if character.active_vitality_points == character.max_vitality_points %}disabled{% endif %}>
                Increase
            </button>
                            <button type="submit" name="decrease_vitality" class="button">Decrease</button>
                            <button type="submit" name="heal_vitality" class="button">Heal to Full</button>
                        </form>
                    </div>
                </div>
                <div class="stat-box">
                    <p class="label">Wound Points</p>
                    <p class="modifier">{{ character.active_wound_points }} // {{ character.max_wound_points }}</p>
                    <div class="buttons">
                        <form action="{{ url_for('update_character', name=character.name) }}" method="post">
                            <button type="submit" name="increase_wound" class="button"
                {% if character.active_wound_points == character.max_wound_points %}disabled{% endif %}>
                Increase
            </button>
                            <button type="submit" name="decrease_wound" class="button">Decrease</button>
                            <button type="submit" name="heal_wound" class="button">Heal to Full</button>
                        </form>
                    </div>
                </div>


                </div>
            </div>
        </div>

        <div class="additional-stats">
            <div class="stats-row">
                <div class="stat-box">
                    <p class="label">Injury Fatigue from Wounds</p>
                    <p class="modifier">{{ character.injury_fatigue }}</p>
<!--                    <div class="buttons">-->
<!--                        <form action="{{ url_for('update_character', name=character.name) }}" method="post">-->
<!--                            <button type="submit" name="decrease_injury_fatigue" class="button">Decrease</button>-->
<!--                            <button type="submit" name="heal_injury_fatigue" class="button">Heal to Full</button>-->
<!--                        </form>-->
<!--                    </div>-->
                </div>
                <div class="stat-box">
                    <p class="label">Exhaustion</p>
                    <p class="modifier">{{ character.exhaustion }}</p>
                    <div class="buttons">
                        <form action="{{ url_for('update_character', name=character.name) }}" method="post">
                            <button type="submit" name="increase_exhaustion" class="button">Increase</button>
                            <button type="submit" name="decrease_exhaustion" class="button">Decrease</button>
                            <button type="submit" name="heal_exhaustion" class="button">Recover to Full</button>
                        </form>
                    </div>
                    </div>

                <div class="stat-box">
                    <p class="label">Manual Injury Fatigue</p>
                    <p class="modifier">{{ character.extra_injury_fatigue }}</p>
                    <div class="buttons">
                        <form action="{{ url_for('update_character', name=character.name) }}" method="post">
                            <button type="submit" name="increase_extra_injury_fatigue" class="button">Increase</button>
                            <button type="submit" name="decrease_extra_injury_fatigue" class="button">Decrease</button>
                            <button type="submit" name="heal_extra_injury_fatigue" class="button">Recover to Full</button>
                        </form>
                    </div>
                    </div>

                </div>
            <br>

             <br>
        <div class="stats-row">
            <div class="stat-box">
                    <form action="{{ url_for('add_debuff', name=character.name) }}" method="post">
                     <label for="debuff">Choose a Debuff:</label>
                         <select id="debuff" name="debuff_name">
                         <option value="debuff_st">Strength</option>
                         <option value="debuff_dx">Dexterity</option>
                             <option value="debuff_in">Intelligence</option>
                             <option value="debuff_ch">Charisma</option>
                             <option value="debuff_cn">Constitution</option>
                             <option value="debuff_wp">Wisdom</option>
                             <option value="debuff_movement">Movement Speed</option>
                             <option value="debuff_height">Height</option>
                             <option value="debuff_max_vp">Max Vitality Points</option>
                             <option value="debuff_max_wp">Max Wound Points</option>

    </select>

    <label for="debuff_value">Value:</label>
    <input type="number" id="debuff_value" name="debuff_value" required>
    <label for="debuff_reason">Reason:</label>
    <input type="string" id="debuff_reason" name="debuff_reason">
     <button type="submit" class="button">Apply Debuff</button>
</form>
                </div>
{% set debuff_labels = {
    "debuff_st": "Strength",
    "debuff_dx": "Dexterity",
    "debuff_in": "Intelligence",
    "debuff_ch": "Charisma",
    "debuff_cn": "Constitution",
    "debuff_wp": "Wisdom",
    "debuff_movement": "Movement Speed",
    "debuff_height": "Height",
    "debuff_max_vp": "Max Vitality Points",
    "debuff_max_wp": "Max Wound Points"
} %}
          </div>
<br>
        <div class="additional-row">
            <div class="stats-row">
                <div class="stat-box">
                    <p class="label">Traits</p>
{% for trait in character.traits %}
    <div class="ability-box">
        <h3>{{ trait.name }}</h3>
        <p><strong>Description:</strong> {{ trait.description }}</p>
        <form action="{{ url_for('edit_trait', name=character.name, trait_id=trait.id) }}" method="post">
            <button type="submit" class="button" >Edit</button>
        </form>
        </div>
            {% endfor %}       <!-- Button to Show/Hide the Add Ability Form -->
<button id="toggleTraitButton" class="button">Add Trait</button>

<!-- Hidden Form -->
<div id="addTraitForm" style="display: none;">
    <h2>Add New Trait</h2>
    <form action="{{ url_for('add_trait', name=character.name) }}" method="post">
        <label for="trait_name">Trait Name:</label>
        <input type="text" id="trait_name" name="trait_name" required>

        <label for="trait_description">Description:</label>
        <textarea id="trait_description" name="trait_description" required></textarea>

         <button type="submit" class="button">Add Trait</button>
    </form>
</div>
<script>
document.getElementById("toggleTraitButton").addEventListener("click", function() {
    var formDiv = document.getElementById("addTraitForm");
    if (formDiv.style.display === "none") {
        formDiv.style.display = "block";
    } else {
        formDiv.style.display = "none";
    }
});
</script>

                </div>

                <div class="stat-box grey-box">
                    <p class="label">Active Abilities</p>


{% for ability in character.active_abilities %}
    <div class="ability-box">
        <h3>{{ ability.name }}</h3>
        <p><strong>Description:</strong> {{ ability.description }}</p>
        <p><strong>DC:</strong> {{ ability.dc }}</p>
        <p><strong>Uses Left:</strong> {{ ability.uses_left }} / {{ ability.uses_per_long_rest }}</p>

        <!-- Use Charge Button -->
<div class="buttons">
        <form action="{{ url_for('use_ability', name=character.name, ability_id=ability.id) }}" method="post">
            <button type="submit" class="button" {% if ability.uses_left == 0 %} disabled {% endif %}>Use Charge</button>
        </form>

   <!-- Decrease DC Button -->

        <form action="{{ url_for('decrease_dc', name=character.name, ability_id=ability.id) }}" method="post">
            <button type="submit" class="button">Decrease DC</button>
        </form>

        <!-- Increase DC Button -->
        <form action="{{ url_for('increase_dc', name=character.name, ability_id=ability.id) }}" method="post">
            <button type="submit" class="button">Increase DC</button>
        </form>
    </div></div>
                    <br>
{% endfor %}

<!-- Button to Show/Hide the Add Ability Form -->
<button id="toggleFormButton" class="button">Add Active Ability</button>

<!-- Hidden Form -->
<div id="addAbilityForm" style="display: none;">
    <h2>Add Active Ability</h2>
    <form action="{{ url_for('add_active_ability', name=character.name) }}" method="post">
        <label for="ability_name">Ability Name:</label>
        <input type="text" id="ability_name" name="ability_name" required>

        <label for="ability_description">Description:</label>
        <textarea id="ability_description" name="ability_description" required></textarea>

        <label for="ability_dc">DC:</label>
        <input type="number" id="ability_dc" name="ability_dc" required>

        <label for="ability_uses">Uses per Long Rest:</label>
        <input type="number" id="ability_uses" name="ability_uses" required>

         <button type="submit" class="button">Add Ability</button>
    </form>
</div>
<script>
document.getElementById("toggleFormButton").addEventListener("click", function() {
    var formDiv = document.getElementById("addAbilityForm");
    if (formDiv.style.display === "none") {
        formDiv.style.display = "block";
    } else {
        formDiv.style.display = "none";
    }
});
</script>

                </div>
                 <div class="stat-box">
                    <form method="post" action="{{ url_for('update_proficiency_bonus', name=character.name) }}">
    <table>
        <tr>
            <th>Skill</th>
            <th>Stat Modifier</th>
            <th>Proficiency Bonus</th>
            <th>Total Bonus</th>
        </tr>
        {% for skill, data in character.skills.items() %}
        <tr>
            <td>{{ skill }}</td>
            <td>{{ "+" if character[data.stat + "_modifier"] >= 0 else "" }}{{ character[data.stat + "_modifier"] }}</td>
            <td>
                <input type="number" name="{{ skill }}" value="{{ data.proficiency_bonus }}" min="0">
            </td>
            <td>
                {{ "+" if (character[data.stat + "_modifier"] + data.proficiency_bonus) >= 0 else "" }}
                {{ character[data.stat + "_modifier"] + data.proficiency_bonus }}
            </td>
        </tr>
        {% endfor %}
    </table>
     <button type="submit" class="button">Update Proficiencies Values</button>
</form>

                        <form method="post" action="{{ url_for('add_custom_skill', name=character.name) }}">
                        <label for="custom_skill_name">Custom Skill Name:</label>
<input type="text" name="custom_skill_name" placeholder="Enter skill name">

<label for="custom_skill_stat">Choose Modifier Stat:</label>
<select name="custom_skill_stat">
    <option value="ST">Strength (ST)</option>
    <option value="DX">Dexterity (DX)</option>
    <option value="CN">Constitution (CN)</option>
    <option value="CH">Charisma (CH)</option>
    <option value="IN">Intelligence (IN)</option>
    <option value="WP">Willpower (WP)</option>
</select>
                              <button type="submit" class="button">Add Custom Skill</button>
</form>
                </div>
            </div>

        </div>
<!-- NEW COLUMN for Inventory, Encumbrance, EMPTY -->
            <div class="stats-row">
                    <div class="container">
        <h1>{{ character.name }}'s Inventory</h1>

        <div class="inventory-table">
            <h2>Inventory</h2>
            <table>
                <thead>
                    <tr>
                        <th>Units</th>
                        <th>Item Name</th>
                        <th>Weight per Unit</th>
                        <th>Total Weight</th>
                        <th>Additional Information</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in character.inventory %}
                        <tr>
                            <td>{{ item.units }}</td>
                            <td>{{ item.item_name }}</td>
                            <td>{{ item.weight_per_unit }}</td>
                            <td>{{ item.total_weight }}</td>
                            <td>{{ item.additional_info }}</td>
                            <td>
                                <form action="{{ url_for('drop_item', name=character.name) }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="item_name" value="{{ item.item_name }}">
                                    <button type="submit" name="action" value="drop">Drop Item</button>
                                </form>
                                <form action="{{ url_for('store_item', name=character.name) }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="item_name" value="{{ item.item_name }}">
                                    <button type="submit" name="action" value="store">Store Item</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4"><strong>TOTAL INVENTORY WEIGHT</strong></td>
                        <td><strong>{{ total_inventory_weight }}</strong></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="on-the-ground-list">
            <h2>On the Ground</h2>
            <table>
                <thead>
                    <tr>
                        <th>Units</th>
                        <th>Item Name</th>
                        <th>Weight per Unit</th>
                        <th>Total Weight</th>
                        <th>Additional Information</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in character.on_the_ground %}
                        <tr>
                            <td>{{ item.units }}</td>
                            <td>{{ item.item_name }}</td>
                            <td>{{ item.weight_per_unit }}</td>
                            <td>{{ item.total_weight }}</td>
                            <td>{{ item.additional_info }}</td>
                            <td>
                                <form action="{{ url_for('pickup_item', name=character.name) }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="item_name" value="{{ item.item_name }}">
                                    <button type="submit" name="action" value="pick_up">Pick Up</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <form action="{{ url_for('reset_on_the_ground', name=character.name) }}" method="POST">
                <button type="submit" name="action" value="reset">Reset On the Ground</button>
            </form>
        </div>

        <div class="house-inventory-list">
            <h2>House Inventory</h2>
            <table>
                <thead>
                    <tr>
                        <th>Units</th>
                        <th>Item Name</th>
                        <th>Weight per Unit</th>
                        <th>Total Weight</th>
                        <th>Additional Information</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in character.house_inventory %}
                        <tr>
                            <td>{{ item.units }}</td>
                            <td>{{ item.item_name }}</td>
                            <td>{{ item.weight_per_unit }}</td>
                            <td>{{ item.total_weight }}</td>
                            <td>{{ item.additional_info }}</td>
                            <td>
                                <form action="{{ url_for('pickup_item', name=character.name) }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="item_name" value="{{ item.item_name }}">
                                    <button type="submit" name="action" value="pick_up">Pick Up</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <a href="{{ url_for('add_item', name=character.name) }}" class="button">Add Item</a>
        <a href="{{ url_for('view_character', name=character.name) }}" class="button">Back to Character</a>
    </div>


                </div>


    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</html>

